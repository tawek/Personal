<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Irregular Verbs Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        html, body {
            margin: 0;
            height: 100%;
            overflow: hidden;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(45deg, #ffb6c1, #add8e6);
        }
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        .game-box {
            background: #fff8dc;
            border: 4px dashed #ff69b4;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 20px #ff69b4;
            text-align: center;
            width: 80%;
            max-width: 500px;
            position: relative;
        }
        h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .word {
            font-size: 2em;
            margin-bottom: 10px;
            color: #ff1493;
        }
        .inputs input {
            font-size: 1.2em;
            margin: 10px;
            padding: 5px 10px;
            border-radius: 10px;
            border: 2px solid #aaa;
        }
        .inputs i {
            cursor: pointer;
            color: #007BFF;
            margin-left: 10px;
        }
        .correct { border-color: green; }
        .wrong { border-color: red; }
        .score {
            margin-top: 10px;
            font-weight: bold;
            font-size: 1.5em;
            color: #444;
        }
        .trophy {
            font-size: 4em;
            color: gold;
            animation: pop 1s infinite alternate;
        }
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border: 5px solid #ff0000;
            border-radius: 15px;
            z-index: 999;
            text-align: center;
            font-size: 1.5em;
            box-shadow: 0 0 30px red;
            display: none;
        }
        .spark {
            position: absolute;
            width: 10px;
            height: 10px;
            background: gold;
            border-radius: 50%;
            animation: sparkle 1s linear forwards;
        }
        @keyframes sparkle {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(3); opacity: 0; top: -100px; }
        }
        @keyframes shake {
            0%, 100% { transform: translate(0); }
            20%, 60% { transform: translate(-10px); }
            40%, 80% { transform: translate(10px); }
        }
        .shake {
            animation: shake 0.5s;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="game-box" id="gameBox">
        <h1>üé® Verb Hero üé∂</h1>
        <div class="word" id="verb">Loading... <i class="fas fa-volume-up" onclick="speak('verb')"></i></div>
        <div class="inputs">
            <input type="text" id="past" placeholder="Past Simple" />
            <i class="fas fa-volume-up" onclick="speak('past')"></i><br />
            <input type="text" id="participle" placeholder="Past Participle" />
            <i class="fas fa-volume-up" onclick="speak('participle')"></i>
        </div>
        <button onclick="check()">Submit</button>
        <div id="scoreDisplay" class="score">Score: 0</div>
    </div>
</div>
<div class="modal" id="modal"></div>
<audio id="failSound" src="puzzle-error.mp3"></audio>
<audio id="successSound" src="success-sound.mp3"></audio>
<script>
    const verbs = [
        ["be", "was/were", "been"], ["become", "became", "become"], ["begin", "began", "begun"],
        ["bring", "brought", "brought"], ["build", "built", "built"], ["buy", "bought", "bought"],
        ["catch", "caught", "caught"], ["choose", "chose", "chosen"], ["come", "came", "come"],
        ["cost", "cost", "cost"], ["cut", "cut", "cut"], ["do", "did", "done"], ["draw", "drew", "drawn"],
        ["drink", "drank", "drunk"], ["drive", "drove", "driven"], ["eat", "ate", "eaten"],
        ["fall", "fell", "fallen"], ["feed", "fed", "fed"], ["feel", "felt", "felt"], ["fight", "fought", "fought"],
        ["find", "found", "found"], ["fly", "flew", "flown"], ["forget", "forgot", "forgotten"],
        ["get", "got", "gotten"], ["give", "gave", "given"], ["go", "went", "gone"],
        ["have", "had", "had"], ["hear", "heard", "heard"], ["keep", "kept", "kept"],
        ["know", "knew", "known"], ["learn", "learned", "learned"], ["leave", "left", "left"],
        ["let", "let", "let"]
    ];

    // List of 20+ positive utterances
    const successUtterances = [
        "Good job!",
        "Yes!",
        "Correct!",
        "Awesome!",
        "Well done!",
        "You got it!",
        "Fantastic!",
        "Brilliant!",
        "Superb!",
        "Excellent!",
        "That's right!",
        "Way to go!",
        "Nice work!",
        "You nailed it!",
        "Great answer!",
        "Keep it up!",
        "Impressive!",
        "You rock!",
        "Spot on!",
        "Marvelous!",
        "Outstanding!",
        "Perfect!",
        "That's the spirit!",
        "You're on fire!",
        "Bingo!",
        "You aced it!",
        "Crushed it!",
        "Magnificent!",
        "You‚Äôre unstoppable!",
        "Legendary!",
        "You‚Äôre a star!",
        "That‚Äôs genius!",
        "You‚Äôre amazing!",
        "You‚Äôre a champ!",
        "You‚Äôre a natural!",
        "You‚Äôre incredible!",
        "You‚Äôre a winner!",
        "You‚Äôre a pro!",
        "You‚Äôre a master!",
        "You‚Äôre a wizard!",
        "You‚Äôre a hero!",
        "You‚Äôre a superstar!",
        "You‚Äôre a legend!",
        "You‚Äôre a whiz!",
        "You‚Äôre a marvel!",
        "You‚Äôre a virtuoso!",
        "You‚Äôre a champion!",
        "You‚Äôre a powerhouse!",
        "You‚Äôre a dynamo!",
        "You‚Äôre a rockstar!"
    ];

    let score = 0;
    let current = [];
    const mistakes = new Map();
    const lastFive = [];

    const verbEl = document.getElementById("verb");
    const scoreDisplay = document.getElementById("scoreDisplay");
    const pastInput = document.getElementById("past");
    const partInput = document.getElementById("participle");
    const modal = document.getElementById("modal");
    const gameBox = document.getElementById("gameBox");
    let enVoice = null;

    function loadEnglishVoice() {
        const voices = speechSynthesis.getVoices();
        enVoice = voices.find(v => v.lang.startsWith('en') && v.localService)
            || voices.find(v => v.lang.startsWith('en'));
    }

    speechSynthesis.onvoiceschanged = loadEnglishVoice;
    loadEnglishVoice(); // also load now

    function chooseVerb() {
        const pool = verbs.flatMap(v => Array(mistakes.get(v[0]) || 1).fill(v));
        let pick;
        do {
            pick = pool[Math.floor(Math.random() * pool.length)];
        } while (lastFive.includes(pick[0]));
        lastFive.push(pick[0]);
        if (lastFive.length > 5) lastFive.shift();
        return pick;
    }

    function update() {
        current = chooseVerb();
        verbEl.innerHTML = `${current[0]} <i class='fas fa-volume-up' onclick="speak('verb')"></i>`;
    }

    function speak(field) {
        let txt;
        if (field === 'past') txt = pastInput.value;
        else if (field === 'participle') txt = partInput.value;
        else txt = current[0];

        const utterance = new SpeechSynthesisUtterance(txt);
        utterance.lang = 'en-US';
        if (enVoice) utterance.voice = enVoice;
        speechSynthesis.speak(utterance);
    }

    function showModal(msg) {
        modal.textContent = msg;
        modal.style.display = 'block';
        speakAll(msg, 0.5); // slower for failures
        setTimeout(() => {
            modal.style.display = 'none';
            pastInput.disabled = false;
            partInput.disabled = false;
            pastInput.focus();
        }, 5000);
    }

    function showSuccessModal() {
        // Pick a random utterance
        const utter = successUtterances[Math.floor(Math.random() * successUtterances.length)];
        modal.textContent = utter;
        setTimeout(() => {
            modal.style.display = 'block';
            speakAll(utter); // normal speed for success
            pastInput.disabled = false;
            partInput.disabled = false;
            pastInput.focus();
        }, 1000);

        setTimeout(() => {
            modal.style.display = 'none';
        }, 3000);

    }

    function speakAll(msg, rate = 1) {
        const utterance = new SpeechSynthesisUtterance(msg);
        utterance.lang = 'en-US';
        utterance.rate = rate;
        if (enVoice) utterance.voice = enVoice;
        speechSynthesis.speak(utterance);
    }

    function addSparkles() {
        for (let i = 0; i < 10; i++) {
            const spark = document.createElement('div');
            spark.className = 'spark';
            spark.style.left = `${Math.random() * 100}%`;
            spark.style.top = `${Math.random() * 100}%`;
            document.body.appendChild(spark);
            setTimeout(() => spark.remove(), 1000);
        }
    }

    function check() {
        const past = pastInput.value.trim().toLowerCase();
        const part = partInput.value.trim().toLowerCase();
        const correctPast = current[1].toLowerCase();
        const correctPart = current[2].toLowerCase();
        const pastOk = past === correctPast;
        const partOk = part === correctPart;

        if (pastOk && partOk) {
            score++;
            scoreDisplay.textContent = `Score: ${score}`;
            addSparkles();
            // Play success sound
            const successSound = document.getElementById("successSound");
            successSound.currentTime = 0;
            successSound.play();
            showSuccessModal();
            if (score >= 50) {
                document.body.innerHTML = `<h1>üèÜ Congratulations!</h1><div class='trophy'>üèÜ</div><p>You mastered the verbs!</p>`;
                return;
            }
            pastInput.value = "";
            partInput.value = "";
            update();
        } else {
            score--;
            scoreDisplay.textContent = `Score: ${score}`;
            pastInput.disabled = true;
            partInput.disabled = true;
            const failSound = document.getElementById("failSound");
            failSound.play();
            // sleep for 1 second
            gameBox.classList.add("shake");
            setTimeout(() => {
                pastInput.disabled = false;
                partInput.disabled = false;
                pastInput.focus();
            }, 1000);
            setTimeout(() => gameBox.classList.remove("shake"), 500);
            document.body.style.background = '#556b2f';
            setTimeout(() => document.body.style.background = 'linear-gradient(45deg, #ffb6c1, #add8e6)', 600);
                setTimeout(() => showModal(`${current[0]}, ${current[1]}, ${current[2]}`), 2000);
            mistakes.set(current[0], (mistakes.get(current[0]) || 1) + 1);
        }
    }

    update();
</script>
</body>
</html>